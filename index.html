<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习越南语请联系Wx:XiDeYueNanYu</title>
    <style>
        body {
            background-color: #f7fbf3;
            margin-bottom: 60px;
        }
        #infoBox { 
            width: 100%; 
            max-width: 700px;
            height: 100px; 
            margin: 0 auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        #contactBox { 
            width: 100%; 
            max-width: 700px;
            height: 45px; 
            margin: 0px auto; 
            border: 1px solid #ccc; 
            background: #68838B; 
            color: #D2B48C; 
            display: flex; 
            align-items: center; 
            justify-content: left; 
            padding-left: 20px;
            font-size: clamp(12px, 2vw, 15px); 
            font-weight: bold;
        }
        .image-frame {
            max-width: 700px;
            margin: 20px auto 0 auto;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none;
            overflow: hidden;
        }
        .image-frame img {
            width: 100%;
            height: auto;
            display: block;
        }
        .content-box {
            max-width: 700px;
            margin: 20px auto;
            padding: 50px;
            border: 10px solid #957652;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 30px;
            font-family: Arial;
            color: #222322;
            line-height: 3;
            text-align: justify;
        }
        .translated-word {
            position: relative;
            display: inline-block;
            white-space: nowrap;
            line-height: 1.3;
            background-color: #bfcdbf;
            color: #000000;
            padding: 4px 4px;
            border-radius: 2px;
        }
        .translation {
            position: absolute;
            top: -29px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            background-color: #eddabc;
            color: #313a2d;
            padding: 4px 4px;
            border-radius: 1px;
            white-space: nowrap;
            z-index: 1;
            line-height: 1;
        }
        .original {
            display: inline;
            line-height: 1;
        }
        .floating-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-align: center;
            display: block;
            z-index: 1000;
        }
        #audioPlayer {
            width: 100%;
            margin-bottom: 10px;
        }
        .time-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .time-box-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .floating-controls p#timeDisplay {
            font-size: 28px;
            color: #FFFFFF;
            background-color: #000000;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0;
        }
        .floating-controls .time-box {
            font-size: 16px;
            color: #FFFFFF;
            background-color: #555555;
            padding: 5px 10px;
            border-radius: 5px;
            min-width: 60px;
        }
        .tua-buttons {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .control-button {
            width: 50px;
            height: 50px;
            background-color: #363535;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }
        .control-button:disabled {
            background-color: #888888;
            cursor: not-allowed;
        }
        .control-button:hover:not(:disabled) {
            background-color: #000000;
        }
        .pause-play-button {
            background-color: #FF4500;
        }
        .pause-play-button:hover {
            background-color: #CC3700;
        }
        .toggle-button {
            background-color: #4682B4;
        }
        .toggle-button:hover {
            background-color: #36648B;
        }
        .loop-button {
            background-color: #3c923c;
        }
        .loop-button:hover {
            background-color: #347d34;
        }
        .clear-button {
            background-color: #bc3f13;
        }
        .clear-button:hover {
            background-color: #d15124;
        }
        .active {
            background-color: #ffffff; 
            border-radius: 5px;
        }
        #quizContainer {
            display: none;
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            color: #53686f;
            font-size: 25px;
            font-weight: bold;
        }
        .question {
            margin-bottom: 20px;
            padding: 18px;
            color: #53686f;
            border: 5px solid #53686f;
            border-radius: 10px;
            background-color: #ffffff;
            font-size: 20px;
            font-weight: bold;
        }
        .options label {
            display: block;
            margin: 15px 0;
            cursor: pointer;
            color: #21292c;
            font-size: 16px;
            font-weight: bold;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            display: none;
            border: 5px solid #53686f;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            background-color: #ffffff;
            color: #007a33;
        }
        .wrong-answer {
            color: #f65936;
            margin: 10px 0;
            font-size: 16px;
            font-weight: bold;
        }
        #submitQuiz {
            font-family: Arial, sans-serif;
            padding: 10px 20px;
            border: 3px solid #53686f;
            background-color: #FF6820;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        #submitQuiz:hover {
            background-color: #ff844a;
        }
        #vocabContainer {
            display: none;
            max-width: 700px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #vocabControls {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 900px;
            background: #68838B;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            margin-bottom: 10px;
        }
        #vocabControls div {
            margin: 5px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #vocabControls button {
            padding: 8px 8px;
            margin: 0 5px;
            cursor: pointer;
            border: 3px solid #5d757d;
            background: #0f1314;
            color: #fffbef;
            font-size: 28px;
            border-radius: 5px;
        }
        #sentenceNumber {
            width: 50px;
            padding: 10px;
            text-align: center;
            border: 3px solid #68838B;
            background: #FFAD5B;
            color: #000;
            border-radius: 10px;
            font-size: 16px;
            -moz-appearance: textfield;
        }
        #sentenceNumber::-webkit-inner-spin-button, 
        #sentenceNumber::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        #sentenceNumber:disabled {
            background: #eee;
        }
        .disabled {
            cursor: not-allowed;
            pointer-events: none;
        }
        .active-mode {
            border: 4px solid orange;
        }
        #vocabIndicator {
            width: 95%;
            max-width: 700px;
            min-height: 50px;
            margin: 10px auto;
            padding: 5px;
            border: 3px solid #734A2E;
            background: #ffffe0;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #vocabOptionsContainer {
            width: 100%;
            max-width: 700px;
            margin: 10px auto;
        }
        .optionBtn {
            width: 95%;
            max-width: 700px;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #734A2E;
            background: #ffffff;
            color: #000;
            font-size: 30px;
            text-align: left;
            cursor: pointer;
            border-radius: 5px;
        }
        .optionBtn:hover {
            background: #D2E4C4;
        }
        .correct {
            background: #B7D7AA !important;
        }
        .wrong {
            background: #CE6D5E !important;
        }
        .floating-mode-bar {
            position: fixed;
            bottom: 0px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #68838B;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0px 5px rgba(0, 0, 0, 1);
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 1000;
            width: 900px;
        }
        .mode-button {
            padding: 10px 20px;
            border: 0px solid #ccc;
            background: #95a8ad;
            color: #293437;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: border-color 0.3s;
        }
        .mode-button.active {
            border: 2px solid #ffffff;
            background: #f0f0f0;
            color: #293437;
        }
        @media (max-width: 768px) { 
            body {
                margin-bottom: 200px;
            }
            #infoBox { 
                width: 90%; 
                height: 120px; 
                font-size: clamp(30px, 4vw, 40px);
            }
            #contactBox { 
                width: 90%; 
                height: 50px; 
                font-size: clamp(14px, 2vw, 16px);
            }
            .image-frame {
                width: 90%;
                margin: 10px auto 0 auto;
            }
            .content-box {
                margin: 10px auto;
                padding: 20px;
                padding-top: 50px;
                padding-bottom: 90px;
                font-size: 19px;
                line-height: 3.5;
            }
            .translated-word {
                padding: 3px 3px;
            }
            .translation {
                top: -25px;
                font-size: 13px;
            }
            .floating-controls {
                top: 10px;
                right: 10px;
                padding: 5px;
            }
            #vocabControls {
                width: 100%;
                bottom: 50px;
                padding: 5px 0;
            }
            #vocabControls button {
                padding: 6px 6px;
                font-size: 20px;
            }
            #sentenceNumber {
                width: 40px;
                padding: 8px;
                font-size: 14px;
            }
            #vocabIndicator {
                min-height: 40px;
            }
            .optionBtn {
                font-size: 20px;
                padding: 8px;
            }
            .floating-mode-bar {
                width: 100%;
            }
        }
        @media (max-width: 400px) {
            .control-button {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            .floating-controls p#timeDisplay {
                font-size: 20px;
            }
            .floating-controls .time-box {
                font-size: 12px;
                min-width: 50px;
            }
        }
    </style>
</head>
<body>
    <div id="infoBox">习得越南语</div>
    <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
    <div id="contentContainer">
        <div class="image-frame" id="imageFrame">
            <img id="contentImage" src="anhminhhoa.jpg" alt="Content Image">
        </div>
        <div class="content-box" id="content"></div>
    </div>
    <div id="quizContainer">
        <h1>回答下面问题</h1>
        <form id="quizForm">
            <div id="questions"></div>
            <button type="button" id="submitQuiz" onclick="checkAnswers()">提交</button>
        </form>
        <div id="result"></div>
    </div>
    <div id="vocabContainer">
        <div id="vocabIndicator"></div>
        <div id="vocabOptionsContainer"></div>
    </div>
    <div class="floating-controls" id="floatingControls">
        <audio id="audioPlayer" src="lesson.mp3" controls></audio>
        <div class="time-row">
            <p id="timeDisplay">00:00</p>
            <div class="time-box-group">
                <span class="time-box" id="loopStart">--:--</span>
                <span class="time-box" id="loopEnd">--:--</span>
            </div>
            <div class="button-group">
                <button class="control-button loop-button" id="loopButton">听</button>
                <button class="control-button clear-button" id="clearButton">删</button>
            </div>
        </div>
        <div class="tua-buttons">
            <button class="control-button" id="rewind5sButton">-5s</button>
            <button class="control-button" id="rewind1sButton">-1s</button>
            <button class="control-button" id="forward1sButton">+1s</button>
            <button class="control-button" id="forward5sButton">+5s</button>
        </div>
        <div class="action-buttons">
            <button class="control-button pause-play-button" id="pausePlayButton">播</button>
            <button class="control-button toggle-button" id="toggleControlsButton">藏</button>
        </div>
    </div>
    <div id="vocabControls">
        <div>
            <button id="prevBtn">◀</button>
            <input type="text" id="sentenceNumber" inputmode="numeric" pattern="[0-9]*">
            <button id="nextBtn">▶</button>
        </div>
        <div>
            <button id="showHideBtn" class="active-mode">显示-隐藏</button>
            <button id="replayBtn">再听一遍</button>
        </div>
    </div>
    <div class="floating-mode-bar">
        <button class="mode-button active" id="contentMode">内容</button>
        <button class="mode-button" id="quizMode">回答问题</button>
        <button class="mode-button" id="vocabMode">词汇</button>
    </div>

    <audio id="vocabAudio" src="audio.mp3"></audio>
    <audio id="correctAudio" src="Dung.mp3"></audio>
    <audio id="wrongAudio" src="Sai.mp3"></audio>

    <script>

const textContentData = [
    `NHÀ CHO THUÊ Ở VIỆT NAM
Những năm gần đây, lượng người nước ngoài tới Việt Nam làm việc ngày càng tăng. Vì vậy, nhu cầu thuê nhà ở cũng ngày càng nhiều. Thị trường nhà cho thuê hiện nay khá phong phú và đa dạng.
Các biệt thự sang trọng ở nơi có cảnh quan thiên nhiên đẹp thường thu hút khách nước ngoài đến thuê để ở hoặc làm văn phòng. Các biệt thự này khá yên tĩnh, sạch sẽ, thường có vườn trước và sau nhà.
Thấp hơn là các nhà cho thuê ở trong phố. Những ngôi nhà này có thể nhỏ hơn biệt thự nhưng đầy đủ tiện nghi và đi lại thuận lợi, nên nhiều người cũng muốn tìm đến.
Các căn hộ chung cư cao cấp cũng là một địa chỉ hấp dẫn khách thuê người nước ngoài bởi cách thiết kế hiện đại và hệ thống dịch vụ tiện lợi.
Ngoài những loại nhà trên, còn có những ngôi nhà nhỏ của gia đình Việt Nam dành cho người nước ngoài, nhất là cho sinh viên thuê. Người thuê có thể thuê một phòng hoặc một tầng, sống cùng một nhà, sinh hoạt cùng với gia đình. Giá thuê của loại nhà này khá rẻ, hợp với túi tiền của sinh viên.
Bên cạnh đó, còn có khá nhiều nhà dành cho người Việt Nam, với giá tiền khác nhau tùy theo loại nhà. Bởi giá nhà liên tục tăng, nên phần lớn người dân có nhu cầu thực sự về nhà ở không đủ khả năng mua nhà. Vì vậy, họ đành tìm giải pháp trước mắt là thuê nhà.
Nếu bạn sống ở Việt Nam lâu dài, hãy thử đi tìm hiểu tình hình trước khi quyết định thuê nhà tại các công ty bất động sản.`
];
const dictionary = {
    "nhà cho thuê": "出租房",
    "Việt Nam": "越南",
    "người nước ngoài": "外国人",
    "làm việc": "工作",
    "nhu cầu": "需求",
    "thuê nhà": "租房",
    "thị trường": "市场",
    "phong phú": "丰富",
    "đa dạng": "多样",
    "biệt thự": "别墅",
    "sang trọng": "豪华",
    "cảnh quan": "景观",
    "thiên nhiên": "自然",
    "đẹp": "美丽",
    "thu hút": "吸引",
    "văn phòng": "办公室",
    "yên tĩnh": "安静",
    "sạch sẽ": "干净",
    "vườn": "花园",
    "phố": "街道",
    "tiện nghi": "便利设施",
    "đi lại": "出行",
    "thuận lợi": "方便",
    "căn hộ": "公寓",
    "chung cư": "居民区",
    "cao cấp": "高级",
    "địa chỉ": "地址",
    "hấp dẫn": "吸引",
    "thiết kế": "设计",
    "hiện đại": "现代",
    "hệ thống": "系统",
    "dịch vụ": "服务",
    "tiện lợi": "便利",
    "gia đình": "家庭",
    "sinh viên": "学生",
    "phòng": "房间",
    "tầng": "楼层",
    "sinh hoạt": "生活",
    "giá thuê": "租金",
    "rẻ": "便宜",
    "hợp": "合适",
    "túi tiền": "钱包",
    "giá tiền": "价格",
    "tăng": "上涨",
    "người dân": "居民",
    "khả năng": "能力",
    "mua nhà": "买房",
    "giải pháp": "解决方案",
    "trước mắt": "暂时",
    "lâu dài": "长期",
    "tìm hiểu": "了解",
    "tình hình": "情况",
    "quyết định": "决定",
    "công ty": "公司",
    "bất động sản": "房地产"
};
const quizData = [
    {
        question: "Theo bài đọc, lý do chính khiến nhu cầu thuê nhà ở Việt Nam tăng trong thời gian gần đây là gì?",
        options: ["Sự phát triển của ngành du lịch", "Số lượng người nước ngoài đến làm việc tăng", "Giá nhà giảm mạnh tại các đô thị lớn", "Nhà ở truyền thống không còn được ưa chuộng"],
        correct: "Số lượng người nước ngoài đến làm việc tăng"
    },
    {
        question: "Loại hình nhà nào thường được dùng làm văn phòng cho người nước ngoài?",
        options: ["Nhà trong ngõ nhỏ", "Căn hộ chung cư cao cấp", "Nhà phố tiện nghi", "Biệt thự ở khu có cảnh quan đẹp"],
        correct: "Biệt thự ở khu có cảnh quan đẹp"
    },
    {
        question: "Điều nào sau đây không đúng với thông tin trong bài?",
        options: ["Biệt thự thường yên tĩnh, có vườn trước và sau", "Nhà trong phố có thể nhỏ nhưng thuận tiện đi lại", "Chung cư cao cấp được thiết kế hiện đại và tiện nghi", "Tất cả người dân Việt Nam đều đủ khả năng mua nhà"],
        correct: "Tất cả người dân Việt Nam đều đủ khả năng mua nhà"
    },
    {
        question: "Có thể suy ra lý do sinh viên nước ngoài thường chọn thuê nhà của các gia đình Việt là:",
        options: ["Có thể học tiếng Việt và văn hóa", "Có phòng riêng với dịch vụ cao cấp", "Giá thuê rẻ và có thể sống cùng người bản xứ", "Gần trường học quốc tế và có bảo vệ 24/7"],
        correct: "Giá thuê rẻ và có thể sống cùng người bản xứ"
    },
    {
        question: "Câu “họ đành tìm giải pháp trước mắt là thuê nhà” phản ánh điều gì?",
        options: ["Thói quen thuê nhà ngày càng phổ biến", "Người dân thích linh hoạt hơn là mua nhà", "Việc thuê nhà là lựa chọn bị động do giá nhà quá cao", "Nhà cho thuê có nhiều ưu đãi hơn so với mua nhà"],
        correct: "Việc thuê nhà là lựa chọn bị động do giá nhà quá cao"
    },
    {
        question: "Tác giả có thái độ như thế nào đối với thị trường nhà cho thuê hiện nay?",
        options: ["Bi quan về sự thiếu kiểm soát giá nhà", "Lạc quan về sự đa dạng và phát triển của thị trường", "Phê phán việc đầu cơ bất động sản", "Trung lập và chỉ tường thuật lại thực tế"],
        correct: "Lạc quan về sự đa dạng và phát triển của thị trường"
    },
    {
        question: "Theo bài, điểm mạnh của các căn hộ chung cư cao cấp là gì?",
        options: ["Giá rẻ và dễ bảo trì", "Gần trung tâm và dễ sửa chữa", "Thiết kế hiện đại và có dịch vụ tiện lợi", "Được nhà nước hỗ trợ tiền thuê"],
        correct: "Thiết kế hiện đại và có dịch vụ tiện lợi"
    },
    {
        question: "Câu “Thị trường nhà cho thuê hiện nay khá phong phú và đa dạng” nhằm nhấn mạnh điều gì?",
        options: ["Giá nhà liên tục thay đổi theo từng khu vực", "Có nhiều loại hình nhà cho thuê phù hợp với từng nhu cầu", "Chính quyền đang kiểm soát chặt thị trường nhà ở", "Tình trạng thừa cung nhà ở tại các khu đô thị mới"],
        correct: "Có nhiều loại hình nhà cho thuê phù hợp với từng nhu cầu"
    },
    {
        question: "Loại hình nhà ở nào cho phép người thuê “sinh hoạt cùng với gia đình”?",
        options: ["Chung cư cao cấp", "Nhà phố tiện nghi", "Biệt thự cho thuê", "Nhà nhỏ của gia đình Việt Nam"],
        correct: "Nhà nhỏ của gia đình Việt Nam"
    },
    {
        question: "Vì sao nhiều người dân Việt Nam không mua được nhà, theo bài đọc?",
        options: ["Thiếu nguồn cung nhà ở trên thị trường", "Chính sách vay vốn bất lợi", "Giá nhà tăng liên tục vượt khả năng tài chính", "Không có nhu cầu mua nhà lâu dài"],
        correct: "Giá nhà tăng liên tục vượt khả năng tài chính"
    },
    {
        question: "Câu “Bạn cứ thử đi khảo sát một vòng, bạn sẽ biết ngay” có thể được hiểu như thế nào?",
        options: ["Thị trường nhà ở quá phức tạp để hiểu hết", "Thông tin trên mạng không đáng tin", "Trải nghiệm thực tế là cách tốt nhất để hiểu rõ thị trường", "Việc thuê nhà cần có người môi giới chuyên nghiệp"],
        correct: "Trải nghiệm thực tế là cách tốt nhất để hiểu rõ thị trường"
    },
    {
        question: "Mục đích chính của bài viết là gì?",
        options: ["Phân tích sự bất bình đẳng trong việc tiếp cận nhà ở", "Đưa ra lời khuyên đầu tư vào thị trường bất động sản Việt Nam", "Giới thiệu các loại hình nhà cho thuê tại Việt Nam cho người nước ngoài và người Việt", "Cảnh báo về những rủi ro trong việc thuê nhà không qua công ty"],
        correct: "Giới thiệu các loại hình nhà cho thuê tại Việt Nam cho người nước ngoài và người Việt"
    }
];
const sentences = [
    {
        "audioFile": "audio.mp3",
        "start": 0.105578,
        "end": 1.165578,
        "correctAnswer": "biệt thự",
        "translation": "别墅",
        "options": [
            "biệt thư",
            "biệc thự",
            "biệt thự",
            "biêt thự"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 1.265578,
        "end": 2.385578,
        "correctAnswer": "sang trọng",
        "translation": "豪华",
        "options": [
            "sang chọng",
            "sang trọng",
            "sang trọnh",
            "săng trọng"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 2.505578,
        "end": 3.655578,
        "correctAnswer": "cảnh quan",
        "translation": "景观",
        "options": [
            "cành quan",
            "cảnh quang",
            "cảnh quan",
            "cảnh khoan"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 3.705578,
        "end": 4.845578,
        "correctAnswer": "tiện nghi",
        "translation": "便利设施",
        "options": [
            "tiện nghi",
            "tiễn nghi",
            "tiện nghì",
            "tiên nghi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 4.905578,
        "end": 6.055578,
        "correctAnswer": "thuận lợi",
        "translation": "方便",
        "options": [
            "thuần lợi",
            "thuận lợi",
            "thuận lơi",
            "thuận lởi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 6.215578,
        "end": 7.255578,
        "correctAnswer": "hấp dẫn",
        "translation": "吸引",
        "options": [
            "hắp dẫn",
            "hấp dẵn",
            "hấp dẫn",
            "hấc dẫn"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 7.505578,
        "end": 8.705578,
        "correctAnswer": "thiết kế",
        "translation": "设计",
        "options": [
            "thiếc kế",
            "thiết kễ",
            "thiết kế",
            "thiếk kế"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 8.755578,
        "end": 9.855578,
        "correctAnswer": "hiện đại",
        "translation": "现代",
        "options": [
            "hiện đai",
            "hiển đại",
            "hiện đại",
            "hiệng đại"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 9.995578,
        "end": 11.165578,
        "correctAnswer": "hệ thống",
        "translation": "系统",
        "options": [
            "hệ thốn",
            "hệt thống",
            "hệ thống",
            "hệ thộng"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 11.315578,
        "end": 12.455578,
        "correctAnswer": "dịch vụ",
        "translation": "服务",
        "options": [
            "dịc vụ",
            "dịch vự",
            "dịch vụ",
            "dịch vù"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 12.585578,
        "end": 13.725578,
        "correctAnswer": "tiện lợi",
        "translation": "便利",
        "options": [
            "tiện lơi",
            "tiên lợi",
            "tiện lợi",
            "tiẹn lợi"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 13.905578,
        "end": 15.085578,
        "correctAnswer": "sinh hoạt",
        "translation": "生活",
        "options": [
            "sinh hoạc",
            "sinh hoạt",
            "xinh hoạt",
            "sinh khoạt"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 15.375578,
        "end": 16.605578,
        "correctAnswer": "giá thuê",
        "translation": "租金",
        "options": [
            "giả thuê",
            "giá thuê",
            "gá thuê",
            "giá thê"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 16.705578,
        "end": 17.785578,
        "correctAnswer": "túi tiền",
        "translation": "钱包",
        "options": [
            "túi tiềng",
            "túi tiên",
            "túi tiền",
            "túi tiển"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 18.075578,
        "end": 19.185578,
        "correctAnswer": "giá tiền",
        "translation": "价格",
        "options": [
            "giá tiềng",
            "gá tiền",
            "giá tiên",
            "giá tiền"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 19.415578,
        "end": 20.555578,
        "correctAnswer": "giải pháp",
        "translation": "解决方案",
        "options": [
            "giải pháp",
            "giãi pháp",
            "giải phấp",
            "giảipháp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 20.775578,
        "end": 21.825578,
        "correctAnswer": "trước mắt",
        "translation": "暂时",
        "options": [
            "trướt mắt",
            "trược mắt",
            "trước mắt",
            "trước mát"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 22.115578,
        "end": 23.315578,
        "correctAnswer": "lâu dài",
        "translation": "长期",
        "options": [
            "lâu giài",
            "lâu dài",
            "lấu dài",
            "lau dài"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 23.505578,
        "end": 24.635578,
        "correctAnswer": "tìm hiểu",
        "translation": "了解",
        "options": [
            "tìm hiểu",
            "tím hiểu",
            "tìm hiễu",
            "tìmh hiểu"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 24.825578,
        "end": 25.895578,
        "correctAnswer": "tình hình",
        "translation": "情况",
        "options": [
            "tinh hình",
            "tình hinh",
            "tình hình",
            "tĩnh hình"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 26.145578,
        "end": 27.175578,
        "correctAnswer": "quyết định",
        "translation": "决定",
        "options": [
            "quyết định",
            "quyệt định",
            "quyết đinh",
            "quết định"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 27.425578,
        "end": 28.745578,
        "correctAnswer": "bất động sản",
        "translation": "房地产",
        "options": [
            "bấc động sản",
            "bất động sãn",
            "bất động sản",
            "bắt động sản"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 29.035578,
        "end": 30.095578,
        "correctAnswer": "cao cấp",
        "translation": "高级",
        "options": [
            "cao cắp",
            "cao cấp",
            "cao cấc",
            "cao gấp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 30.315578,
        "end": 31.515578,
        "correctAnswer": "chung cư",
        "translation": "居民区",
        "options": [
            "chung cứ",
            "chùng cư",
            "chung cư",
            "chưng cư"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 31.715578,
        "end": 32.805578,
        "correctAnswer": "căn hộ",
        "translation": "公寓",
        "options": [
            "căng hộ",
            "căn hố",
            "căn hộ",
            "can hộ"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 33.105578,
        "end": 33.935578,
        "correctAnswer": "hợp",
        "translation": "合适",
        "options": [
            "hợp",
            "hợb",
            "hơp",
            "hẹp"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 34.205578,
        "end": 35.375578,
        "correctAnswer": "nhu cầu",
        "translation": "需求",
        "options": [
            "nhu cầ",
            "nhu cầu",
            "nhu cầuu",
            "nho cầu"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 35.565578,
        "end": 36.685578,
        "correctAnswer": "phong phú",
        "translation": "丰富",
        "options": [
            "phông phú",
            "phọng phú",
            "phong phú",
            "phung phú"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 36.915578,
        "end": 38.015578,
        "correctAnswer": "đa dạng",
        "translation": "多样",
        "options": [
            "đa dang",
            "đa dạng",
            "đà dạng",
            "da dạng"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 38.155578,
        "end": 39.335578,
        "correctAnswer": "sang trọng",
        "translation": "豪华",
        "options": [
            "sang trọng",
            "sang trọmg",
            "sảng trọng",
            "sang trộng"
        ]
    }
];

        // Xử lý hiển thị văn bản với từ điển
        const content = document.getElementById('content');
        function renderText() {
            let html = textContentData[0].replace(/\n/g, "<br>");
            const sortedKeys = Object.keys(dictionary).sort((a, b) => b.length - a.length);
            const replacements = [];

            sortedKeys.forEach(key => {
                const regex = new RegExp(`(\\b|[.,!?\\n\\s]|^)(${key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})(\\b|[.,!?\\n\\s]|$)`, 'gi');
                let match;
                while ((match = regex.exec(html)) !== null) {
                    const start = match.index + match[1].length;
                    const end = start + match[2].length;
                    replacements.push({
                        start,
                        end,
                        original: match[2],
                        prefix: match[1],
                        suffix: match[3],
                        translation: dictionary[key]
                    });
                }
            });

            replacements.sort((a, b) => a.start - b.start);
            const filteredReplacements = [];
            let lastEnd = -1;
            for (const replacement of replacements) {
                if (replacement.start >= lastEnd) {
                    filteredReplacements.push(replacement);
                    lastEnd = replacement.end;
                }
            }

            for (let i = filteredReplacements.length - 1; i >= 0; i--) {
                const { start, end, original, prefix, suffix, translation } = filteredReplacements[i];
                const translatedHtml = `${prefix}<span class="translated-word"><span class="translation">${translation}</span><span class="original">${original}</span></span>${suffix}`;
                html = html.slice(0, start - prefix.length) + translatedHtml + html.slice(end + suffix.length);
            }

            content.innerHTML = html;
        }

        // Xử lý hiển thị ảnh
        const imageFrame = document.getElementById('imageFrame');
        const contentImage = document.getElementById('contentImage');
        const imageSrc = "anhminhhoa.jpg";
        function renderImage() {
            if (imageSrc) {
                contentImage.src = imageSrc;
                imageFrame.style.display = 'block';
            } else {
                imageFrame.style.display = 'none';
            }
        }

        // Xử lý audio và bảng điều khiển
        const audioPlayer = document.getElementById("audioPlayer");
        const floatingControls = document.getElementById("floatingControls");
        if (!floatingControls) {
            console.error('Không tìm thấy floatingControls');
        }
        const timeDisplay = floatingControls ? floatingControls.querySelector("#timeDisplay") : null;
        const loopStart = floatingControls ? floatingControls.querySelector("#loopStart") : null;
        const loopEnd = floatingControls ? floatingControls.querySelector("#loopEnd") : null;
        const loopButton = floatingControls ? floatingControls.querySelector("#loopButton") : null;
        const clearButton = floatingControls ? floatingControls.querySelector("#clearButton") : null;
        const rewind5sButton = floatingControls ? floatingControls.querySelector("#rewind5sButton") : null;
        const rewind1sButton = floatingControls ? floatingControls.querySelector("#rewind1sButton") : null;
        const forward1sButton = floatingControls ? floatingControls.querySelector("#forward1sButton") : null;
        const forward5sButton = floatingControls ? floatingControls.querySelector("#forward5sButton") : null;
        const pausePlayButton = floatingControls ? floatingControls.querySelector("#pausePlayButton") : null;
        const toggleControlsButton = floatingControls ? floatingControls.querySelector("#toggleControlsButton") : null;
        const tuaButtons = floatingControls ? floatingControls.querySelector(".tua-buttons") : null;

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay(displayElement) {
            if (displayElement) {
                displayElement.textContent = formatTime(audioPlayer.currentTime);
            }
        }

        let customLoopStart = null;
        let customLoopEnd = null;
        let clickCount = 0;
        let isLooping = false;

        if (timeDisplay) {
            const updateInterval = setInterval(() => updateTimeDisplay(timeDisplay), 1000);
            timeDisplay.onclick = () => {
                if (audioPlayer.paused) {
                    clickCount++;
                    if (clickCount === 1) {
                        customLoopStart = audioPlayer.currentTime;
                        loopStart.textContent = formatTime(customLoopStart);
                    } else if (clickCount === 2) {
                        customLoopEnd = audioPlayer.currentTime;
                        if (customLoopEnd <= customLoopStart) {
                            customLoopEnd = null;
                            loopEnd.textContent = "--:--";
                        } else {
                            loopEnd.textContent = formatTime(customLoopEnd);
                        }
                        clickCount = 0;
                    }
                }
            };
        }

        if (audioPlayer) {
            audioPlayer.ontimeupdate = function() {
                updateTimeDisplay(timeDisplay);
                if (isLooping && customLoopStart !== null && customLoopEnd !== null) {
                    if (audioPlayer.currentTime >= customLoopEnd) {
                        audioPlayer.currentTime = customLoopStart;
                    }
                }
            };
        }

        if (rewind5sButton) {
            rewind5sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 5);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (rewind1sButton) {
            rewind1sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 1);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (forward1sButton) {
            forward1sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 1);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }
        if (forward5sButton) {
            forward5sButton.onclick = () => {
                if (!isLooping) {
                    audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 5);
                    updateTimeDisplay(timeDisplay);
                }
            };
        }

        if (pausePlayButton) {
            pausePlayButton.onclick = () => {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    pausePlayButton.textContent = "停";
                } else {
                    audioPlayer.pause();
                    pausePlayButton.textContent = "播";
                }
            };
        }

        if (loopButton) {
            loopButton.onclick = () => {
                if (customLoopStart !== null && customLoopEnd !== null) {
                    audioPlayer.currentTime = customLoopStart;
                    audioPlayer.play();
                    isLooping = true;
                    if (rewind5sButton) rewind5sButton.disabled = true;
                    if (rewind1sButton) rewind1sButton.disabled = true;
                    if (forward1sButton) forward1sButton.disabled = true;
                    if (forward5sButton) forward5sButton.disabled = true;
                }
            };
        }

        if (clearButton) {
            clearButton.onclick = () => {
                customLoopStart = null;
                customLoopEnd = null;
                if (loopStart) loopStart.textContent = "--:--";
                if (loopEnd) loopEnd.textContent = "--:--";
                clickCount = 0;
                isLooping = false;
                if (rewind5sButton) rewind5sButton.disabled = false;
                if (rewind1sButton) rewind1sButton.disabled = false;
                if (forward1sButton) forward1sButton.disabled = false;
                if (forward5sButton) forward5sButton.disabled = false;
            };
        }

        let controlsVisible = true;
        if (toggleControlsButton) {
            toggleControlsButton.onclick = () => {
                if (controlsVisible) {
                    if (timeDisplay) timeDisplay.style.display = "none";
                    if (tuaButtons) tuaButtons.style.display = "none";
                    if (pausePlayButton) pausePlayButton.style.display = "none";
                    if (loopStart) loopStart.style.display = "none";
                    if (loopEnd) loopEnd.style.display = "none";
                    if (loopButton) loopButton.style.display = "none";
                    if (clearButton) clearButton.style.display = "none";
                    toggleControlsButton.textContent = "示";
                    controlsVisible = false;
                } else {
                    if (timeDisplay) timeDisplay.style.display = "inline-block";
                    if (tuaButtons) tuaButtons.style.display = "flex";
                    if (pausePlayButton) pausePlayButton.style.display = "inline-flex";
                    if (loopStart) loopStart.style.display = "inline-block";
                    if (loopEnd) loopEnd.style.display = "inline-block";
                    if (loopButton) loopButton.style.display = "inline-flex";
                    if (clearButton) clearButton.style.display = "inline-flex";
                    toggleControlsButton.textContent = "藏";
                    controlsVisible = true;
                }
            };
        }

        if (audioPlayer) {
            audioPlayer.onpause = audioPlayer.onended = function() {
                if (pausePlayButton) pausePlayButton.textContent = "播";
            };
        }

        // Xử lý chế độ từ vựng
        const vocabAudio = document.getElementById('vocabAudio');
        const correctAudio = document.getElementById('correctAudio');
        const wrongAudio = document.getElementById('wrongAudio');
        const vocabIndicator = document.getElementById('vocabIndicator');
        const sentenceNumber = document.getElementById('sentenceNumber');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const replayBtn = document.getElementById('replayBtn');
        const showHideBtn = document.getElementById('showHideBtn');
        const vocabOptionsContainer = document.getElementById('vocabOptionsContainer');

        let currentIndex = 0;
        let showAnswer = true;
        let isPlaying = false;

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function updateVocabDisplay() {
            if (sentenceNumber) sentenceNumber.value = currentIndex + 1;
            if (vocabIndicator) {
                vocabIndicator.style.background = '#ffffe0';
                vocabIndicator.innerHTML = showAnswer ? `
                    <div style="font-size: 20px; font-weight: normal; color: #38761d;">${sentences[currentIndex].translation}</div>
                ` : '';
            }
            updateVocabOptions();
            playCurrentSentence();
        }

        function updateVocabOptions() {
            if (vocabOptionsContainer) {
                vocabOptionsContainer.innerHTML = '';
                const shuffledOptions = shuffleArray(sentences[currentIndex].options);
                shuffledOptions.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'optionBtn';
                    btn.textContent = option;
                    btn.onclick = () => checkVocabAnswer(option);
                    vocabOptionsContainer.appendChild(btn);
                });
            }
        }

        function playCurrentSentence() {
            if (isPlaying) vocabAudio.pause();
            [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.add('disabled'));
            if (sentenceNumber) sentenceNumber.disabled = true;
            isPlaying = true;
            vocabAudio.src = sentences[currentIndex].audioFile;
            vocabAudio.currentTime = sentences[currentIndex].start;
            vocabAudio.play().catch(error => {
                console.error('Audio playback failed:', error);
                alert('Vui lòng nhấn nút “再听一遍” để phát âm thanh.');
                [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.remove('disabled'));
                if (sentenceNumber) sentenceNumber.disabled = false;
                isPlaying = false;
            });

            vocabAudio.ontimeupdate = () => {
                if (vocabAudio.currentTime >= sentences[currentIndex].end) {
                    vocabAudio.pause();
                    vocabAudio.ontimeupdate = null;
                    [prevBtn, nextBtn, replayBtn, showHideBtn].forEach(btn => btn && btn.classList.remove('disabled'));
                    if (sentenceNumber) sentenceNumber.disabled = false;
                    isPlaying = false;
                }
            };
        }

        function moveSentence(direction) {
            currentIndex = (currentIndex + direction + sentences.length) % sentences.length;
            updateVocabDisplay();
        }

        function checkVocabAnswer(selectedAnswer) {
            const correctAnswer = sentences[currentIndex].correctAnswer;
            const optionButtons = vocabOptionsContainer.getElementsByClassName('optionBtn');

            for (let btn of optionButtons) {
                btn.classList.remove('correct', 'wrong');
                if (btn.textContent === selectedAnswer) {
                    if (selectedAnswer === correctAnswer) {
                        vocabIndicator.style.background = '#B7D7AA';
                        btn.classList.add('correct');
                        correctAudio.play().catch(error => console.error('Correct audio playback failed:', error));
                        correctAudio.onended = () => {
                            setTimeout(() => moveSentence(1), 200);
                        };
                    } else {
                        vocabIndicator.style.background = '#CE6D5E';
                        btn.classList.add('wrong');
                        wrongAudio.play().catch(error => console.error('Wrong audio playback failed:', error));
                        wrongAudio.onended = null;
                    }
                }
            }
        }

        if (prevBtn) {
            prevBtn.onclick = () => {
                if (!isPlaying) moveSentence(-1);
            };
        }

        if (nextBtn) {
            nextBtn.onclick = () => {
                if (!isPlaying) moveSentence(1);
            };
        }

        if (replayBtn) {
            replayBtn.onclick = () => {
                if (!isPlaying) playCurrentSentence();
            };
        }

        if (showHideBtn) {
            showHideBtn.onclick = () => {
                if (!isPlaying) {
                    showAnswer = !showAnswer;
                    showHideBtn.classList.toggle('active-mode');
                    updateVocabDisplay();
                }
            };
        }

        if (sentenceNumber) {
            sentenceNumber.onchange = () => {
                if (!isPlaying) {
                    const num = parseInt(sentenceNumber.value) - 1;
                    if (!isNaN(num) && num >= 0 && num < sentences.length) {
                        currentIndex = num;
                        updateVocabDisplay();
                    } else {
                        alert(`输入范围： 1 到 ${sentences.length}`);
                        updateVocabDisplay();
                    }
                }
            };

            sentenceNumber.onkeydown = (e) => {
                if (!isPlaying) {
                    if (e.key === 'ArrowLeft') moveSentence(-1);
                    if (e.key === 'ArrowRight') moveSentence(1);
                }
            };
        }

        function initVocab() {
            currentIndex = 0;
            showAnswer = true;
            isPlaying = false;
            updateVocabDisplay();
        }

        // Xử lý câu hỏi
        let contentScrollPosition = 0;
        let quizScrollPosition = 0;
        let vocabScrollPosition = 0;
        let userSelections = {};
        let isSubmitted = false;

        function loadQuiz() {
            const questionsDiv = document.getElementById('questions');
            if (questionsDiv) {
                questionsDiv.innerHTML = '';
                quizData.forEach((item, index) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question';
                    const questionTitle = document.createElement('h3');
                    questionTitle.textContent = `Câu ${index + 1}: ${item.question}`;
                    questionDiv.appendChild(questionTitle);

                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'options';
                    item.options.forEach(option => {
                        const label = document.createElement('label');
                        const isChecked = userSelections[`question${index}`] === option ? 'checked' : '';
                        label.innerHTML = `
                            <input type="radio" name="question${index}" value="${option}" ${isChecked}>
                            ${option}
                        `;
                        optionsDiv.appendChild(label);
                    });

                    questionDiv.appendChild(optionsDiv);
                    questionsDiv.appendChild(questionDiv);
                });
                window.scrollTo(0, quizScrollPosition);
            }
        }

        function saveSelections() {
            quizData.forEach((_, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    userSelections[`question${index}`] = selected.value;
                }
            });
        }

        function checkAnswers() {
            let score = 0;
            const total = quizData.length;
            let wrongAnswers = [];
            quizData.forEach((item, index) => {
                const selected = document.querySelector(`input[name="question${index}"]:checked`);
                if (selected) {
                    if (selected.value === item.correct) {
                        score++;
                    } else {
                        wrongAnswers.push({
                            question: item.question,
                            selected: selected.value,
                            correct: item.correct
                        });
                    }
                } else {
                    wrongAnswers.push({
                        question: item.question,
                        selected: "未选择",
                        correct: item.correct
                    });
                }
            });

            const resultDiv = document.getElementById('result');
            if (resultDiv) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <h3>YD-
NCTOVN
-结果: ${score}/${total} 答案正确</h3>
                    <p>比例: ${(score/total * 100).toFixed(2)}%</p>
                `;
                if (wrongAnswers.length > 0) {
                    resultDiv.innerHTML += '<h4>错误答案:</h4>';
                    wrongAnswers.forEach((wrong, index) => {
                        resultDiv.innerHTML += `
                            <div class="wrong-answer">
                                Câu ${quizData.findIndex(q => q.question === wrong.question) + 1}: ${wrong.question}<br>
                                你的选择: ${wrong.selected} - 正确答案: ${wrong.correct}
                            </div>
                        `;
                    });
                } else {
                    resultDiv.innerHTML += '<p>回答正确所有问题</p>';
                }
                resultDiv.scrollIntoView({ behavior: 'smooth' });
                isSubmitted = true;
            }
        }

        // Xử lý chế độ hiển thị
        const contentModeButton = document.getElementById('contentMode');
        const quizModeButton = document.getElementById('quizMode');
        const vocabModeButton = document.getElementById('vocabMode');
        const contentContainer = document.getElementById('contentContainer');
        const quizContainer = document.getElementById('quizContainer');
        const vocabContainer = document.getElementById('vocabContainer');
        const vocabControls = document.getElementById('vocabControls');

        if (contentModeButton) {
            contentModeButton.addEventListener('click', () => {
                quizScrollPosition = window.scrollY;
                vocabScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'block';
                quizContainer.style.display = 'none';
                vocabContainer.style.display = 'none';
                vocabControls.style.display = 'none';
                contentModeButton.classList.add('active');
                quizModeButton.classList.remove('active');
                vocabModeButton.classList.remove('active');
                floatingControls.style.display = 'block';
                renderText();
                renderImage();
                window.scrollTo(0, contentScrollPosition);
            });
        }

        if (quizModeButton) {
            quizModeButton.addEventListener('click', () => {
                contentScrollPosition = window.scrollY;
                vocabScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'none';
                quizContainer.style.display = 'block';
                vocabContainer.style.display = 'none';
                vocabControls.style.display = 'none';
                quizModeButton.classList.add('active');
                contentModeButton.classList.remove('active');
                vocabModeButton.classList.remove('active');
                floatingControls.style.display = 'none';
                if (isSubmitted) {
                    userSelections = {};
                    isSubmitted = false;
                }
                loadQuiz();
            });
        }

        if (vocabModeButton) {
            vocabModeButton.addEventListener('click', () => {
                contentScrollPosition = window.scrollY;
                quizScrollPosition = window.scrollY;
                saveSelections();
                contentContainer.style.display = 'none';
                quizContainer.style.display = 'none';
                vocabContainer.style.display = 'block';
                vocabControls.style.display = 'block';
                vocabModeButton.classList.add('active');
                contentModeButton.classList.remove('active');
                quizModeButton.classList.remove('active');
                floatingControls.style.display = 'none';
                initVocab();
                window.scrollTo(0, vocabScrollPosition);
            });
        }

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', () => {
            renderText();
            renderImage();
            contentContainer.style.display = 'block';
            quizContainer.style.display = 'none';
            vocabContainer.style.display = 'none';
            vocabControls.style.display = 'none';
        });
    </script>
</body>
</html>